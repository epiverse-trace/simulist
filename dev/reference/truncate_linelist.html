<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Adjust or subset a line list to account for right truncation — truncate_linelist • simulist</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Adjust or subset a line list to account for right truncation — truncate_linelist"><meta name="description" content="Adjust or subset the line list &amp;lt;data.frame&amp;gt; by either changing dates that
are within the right-truncation window to NA or removing cases that have
occurred within a delay period. This occurs to recent cases or outcomes
that are not yet recorded in the line list and will be revised upwards. See
truncation_event argument documentation for different types of truncation."><meta property="og:description" content="Adjust or subset the line list &amp;lt;data.frame&amp;gt; by either changing dates that
are within the right-truncation window to NA or removing cases that have
occurred within a delay period. This occurs to recent cases or outcomes
that are not yet recorded in the line list and will be revised upwards. See
truncation_event argument documentation for different types of truncation."><meta property="og:image" content="https://epiverse-trace.github.io/simulist/logo.svg"><meta name="robots" content="noindex"><!-- Google tag (gtag.js) --><script async src="https://www.googletagmanager.com/gtag/js?id=G-XZ471458FQ"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-XZ471458FQ');
</script></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">
    <a href="https://epiverse-trace.github.io/" class="external-link"><img src="https://epiverse-trace.github.io/blueprints/logo_white.svg" id="logo" alt="Epiverse-TRACE"></a>
    <a class="navbar-brand me-2" href="../index.html">simulist</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.4.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/simulist.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Customising simulated outbreak</h6></li>
    <li><a class="dropdown-item" href="../articles/age-strat-risks.html">Age-stratified hospitalisation and death risks</a></li>
    <li><a class="dropdown-item" href="../articles/age-struct-pop.html">Age-structured population</a></li>
    <li><a class="dropdown-item" href="../articles/time-varying-cfr.html">Time-varying case fatality risk</a></li>
    <li><a class="dropdown-item" href="../articles/reporting-delays-truncation.html">Reporting delays and right-truncation of line list data</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Wrangling and plotting data</h6></li>
    <li><a class="dropdown-item" href="../articles/wrangling-linelist.html">Wrangling simulated outbreak data</a></li>
    <li><a class="dropdown-item" href="../articles/vis-linelist.html">Visualising simulated data</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Developer Documentation</h6></li>
    <li><a class="dropdown-item" href="../articles/design-principles.html">Design Principles for {simulist}</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/epiverse-trace/simulist/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch"><li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Adjust or subset a line list to account for right truncation</h1>
      <small class="dont-index">Source: <a href="https://github.com/epiverse-trace/simulist/blob/main/R/truncate_linelist.R" class="external-link"><code>R/truncate_linelist.R</code></a></small>
      <div class="d-none name"><code>truncate_linelist.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Adjust or subset the line list <code>&lt;data.frame&gt;</code> by either changing dates that
are within the right-truncation window to <code>NA</code> or removing cases that have
occurred within a delay period. This occurs to recent cases or outcomes
that are not yet recorded in the line list and will be revised upwards. See
<code>truncation_event</code> argument documentation for different types of truncation.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">truncate_linelist</span><span class="op">(</span></span>
<span>  <span class="va">linelist</span>,</span>
<span>  delay <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Lognormal.html" class="external-link">rlnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">x</span>, meanlog <span class="op">=</span> <span class="fl">0.58</span>, sdlog <span class="op">=</span> <span class="fl">0.47</span><span class="op">)</span>,</span>
<span>  max_date <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  truncation_event <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"reporting"</span>, <span class="st">"onset"</span>, <span class="st">"admission"</span>, <span class="st">"outcome"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-linelist">linelist<a class="anchor" aria-label="anchor" href="#arg-linelist"></a></dt>
<dd><p>Line list <code>&lt;data.frame&gt;</code> output from <code><a href="sim_linelist.html">sim_linelist()</a></code>.</p></dd>


<dt id="arg-delay">delay<a class="anchor" aria-label="anchor" href="#arg-delay"></a></dt>
<dd><p>A <code>function</code> (either anonymous or predefined) that
has a single argument and generates random numbers given a probability
distribution. The function must return a vector of real numbers for
representing the reporting delay between the right-truncation point and the
cut off date (<code>max_date</code>).</p>
<p>Default is a random number generator that is lognormally
distributed (<code><a href="https://rdrr.io/r/stats/Lognormal.html" class="external-link">rlnorm()</a></code>) delay with parameters <code>meanlog = 0.58</code> and
<code>sdlog = 0.47</code>, which corresponds to a mean of 2 and a standard deviation
of 1.</p></dd>


<dt id="arg-max-date">max_date<a class="anchor" aria-label="anchor" href="#arg-max-date"></a></dt>
<dd><p>A maximum date to cut off the outbreak and apply reporting
delays. Default is <code>NULL</code>, so the maximum date will be automatically
calculated as the date at the end of the outbreak (i.e. date of the last
outcome).</p></dd>


<dt id="arg-truncation-event">truncation_event<a class="anchor" aria-label="anchor" href="#arg-truncation-event"></a></dt>
<dd><p>A <code>character</code> string with which event in the line
list the right truncation should apply to. The default is <code>"reporting"</code> for
the reporting delay, which is likely the most common form of right truncation
in real-time outbreak data. When <code>truncation_event = "reporting"</code> if a date
of reporting (<code>$date_reporting</code>) is more recent than the sampled truncation
time then the individual (row) is removed from the line list. If the date of
reporting is less recent than the sampled truncation time but either the
date of hospitalisation (<code>$date_admission</code>) or date of outcome
(<code>$date_outcome</code>) is more recent than the sampled truncation time then these
dates are converted from <code>Date</code>s to <code>NA</code>s.</p>
<p>The other options for <code>truncation_event</code> are <code>"onset"</code>, <code>"admission"</code>
or <code>"outcome"</code>.  If these are chosen then if the truncation point is more
recent than the date of symptom onset, date of hospital admission, or
date of outcome (death or recovery), respectively, then these individuals
(rows) will be removed from the line list (i.e. the <code>&lt;data.frame&gt;</code> is
subset). If the event is less recent than the sampled truncation time then
any events after the truncation point will be set to <code>NA</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A line list <code>&lt;data.frame&gt;</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The truncation window is sampled for each individual and is specified by a
(random) number generating function supplied to the <code>delay</code>
argument. Therefore, if this function has variability
(e.g. a probability distribution) it will not be a fixed time window for
all individuals. It is possible that someone with a more recent date of
onset is kept but someone with a less recent date of onset is removed due
to the variability in the reporting delays. See examples for variable or
fixed <code>delay</code> functions.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="fu"><a href="sim_linelist.html">sim_linelist</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">linelist_trunc</span> <span class="op">&lt;-</span> <span class="fu">truncate_linelist</span><span class="op">(</span><span class="va">linelist</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># set maximum date to apply truncation to 2023-01-01</span></span></span>
<span class="r-in"><span><span class="va">linelist_trunc</span> <span class="op">&lt;-</span> <span class="fu">truncate_linelist</span><span class="op">(</span><span class="va">linelist</span>, max_date <span class="op">=</span> <span class="st">"2023-01-01"</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Truncation max date is: 2023-01-01.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Assuming an origin of '1970-01-01' in line with R &gt;= v4.3.0.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># apply longer truncation to hospital admission</span></span></span>
<span class="r-in"><span><span class="va">linelist_trunc</span> <span class="op">&lt;-</span> <span class="fu">truncate_linelist</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">linelist</span>,</span></span>
<span class="r-in"><span>  delay <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Lognormal.html" class="external-link">rlnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">x</span>, meanlog <span class="op">=</span> <span class="fl">2</span>, sdlog <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  truncation_event <span class="op">=</span> <span class="st">"admission"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># variable right truncation with mean 2 and sd 1 (default behaviour)</span></span></span>
<span class="r-in"><span><span class="va">linelist_trunc</span> <span class="op">&lt;-</span> <span class="fu">truncate_linelist</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">linelist</span>,</span></span>
<span class="r-in"><span>  delay <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Lognormal.html" class="external-link">rlnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">x</span>, meanlog <span class="op">=</span> <span class="fl">0.58</span>, sdlog <span class="op">=</span> <span class="fl">0.47</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># fixed right truncation of 5 days</span></span></span>
<span class="r-in"><span><span class="va">linelist_trunc</span> <span class="op">&lt;-</span> <span class="fu">truncate_linelist</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">linelist</span>,</span></span>
<span class="r-in"><span>  delay <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">5</span>, n <span class="op">=</span> <span class="va">x</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Joshua W. Lambert, Carmen Tamayo.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

